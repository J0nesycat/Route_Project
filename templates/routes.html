{% extends 'base.html' %}
{% load static %}
{% block content %}

<h2>מערכת לבניית מסלולים</h2>

<form id="route-form" method="POST" action="{% url 'generate_routes' %}">
    {% csrf_token %}
    <label for="summary_date">בחר יום הפצה:</label>
    <select name="summary_date" id="summary_date" required>
        {% for summary in summaries %}
            <option value="{{ summary.date }}">{{ summary.date|date:"F j, Y" }}</option>
        {% endfor %}
    </select>

    <button type="submit" id="generate-button">🚛 בניית מסלול חדש</button>
    <button type="button" id="load-button">📦 תצוגת מסלול קיים</button>
</form>

{% if error %}
    <p style="color: red;">❌ {{ error }}</p>
{% endif %}

<h3>מסלולים</h3>
<ul id="route-list" style="list-style: none; padding-right: 0;" dir="rtl"></ul>
<p id="no-routes-msg" style="display: none;">לא נמצאו מסלולים לתאריך זה לחץ על בניית מסלול </p>

<h2>תצוגת מפה</h2>
<div id="map" style="width: 100%; height: 500px;"></div>

<!-- Fullscreen loading overlay -->
<div id="loading-overlay">
    <!-- Background video -->
    <video class="bg-video" autoplay muted loop playsinline>
        <source src="{% static 'videos/loading.mp4' %}" type="video/mp4">
        הדפדפן שלך לא תומך בסרטונים
    </video>

    <!-- Foreground content -->
    <div class="loading-message">
        <div class="loading-text">
            אנא המתן בתהליך בניית מסלול
            <span class="loading-dots"></span>
        </div>
    </div>
</div>



{% block extra_head %}
    <link rel="stylesheet" href="{% static 'css/routes.css' %}">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.css" rel="stylesheet" />
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.js"></script>
    <script>
        window.mapbox_token = "{{ mapbox_token }}";
    </script>
    <script src="{% static 'js/routes.js' %}"></script>
{% endblock %}

{% endblock %}
